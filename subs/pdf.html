<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10">
	<title>Neutrino-Light-Curve</title>
	<script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.min.mjs"></script>
	<!-- <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf_viewer.mjs"></script> -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf_viewer.min.css" integrity="sha512-3RmdRrL3AYc82NkZyJY3Id9029bY37R6LtgNQkNRdZm+eI0sVjV/J5IF9QsC8VDUheqJ9pxCBQc8ts6wiOXIOg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="../css/normalize.css"/>
	<link rel="stylesheet" href="../css/subs.css"/>
	<link rel="shortcut icon" href="https://raw.githubusercontent.com/Jeffreymaomao/Jeffreymaomao/refs/heads/main/assets/selfy800x800.png" />
</head>
<body>
	<h1>Neutrino Light Curves of Core-Collapse Supernovae</h1>
	<script>
		window.addEventListener('load', function() {
			if (typeof pdfjsLib === 'undefined') {
				console.log('Please include the PDF.js library first');
			}
			pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.mjs"
			const pdfContainers = document.querySelectorAll(".pdf-container")
			pdfContainers.forEach(rederPDF)
		});
		function rederPDF(pdfContainer) {
			const dataUrl     = pdfContainer.getAttribute("data-url");
			const pdfCanvas   = pdfContainer.querySelector(".pdf-canvas");
			const pdfText     = pdfContainer.querySelector(".pdf-text");
			const loadingTask = pdfjsLib.getDocument(dataUrl);
			if(!pdfCanvas || !pdfText){
				console.log("Canvas or Text element not found");
				return;
			}
			let viewport = null;
			loadingTask.promise.then(pdf=>{
				return pdf.getPage(1)
			}).then(page=>{
				viewport = page.getViewport({ scale: 2.0 });
				pdfCanvas.height = viewport.height;
				pdfCanvas.width  = viewport.width;
				return page.render({
					canvasContext: pdfCanvas.getContext('2d'),
					viewport: viewport
				}).promise.then(() => page);
			}).then(page => {
				return page.getTextContent();
			}).then(textContent => {
				pdfText.innerHTML = "";
				pdfText.style.setProperty('--scale-factor', viewport.scale)
				const textLayer = new pdfjsLib.TextLayer({
					container: pdfText,
					textContentSource: textContent,
					viewport: viewport,
				});
				textLayer.render(); 
			}).catch(error => {
				console.error("PDF.js rendering error: ", error);
			});
		}
	</script>
	<main>
		<div class="pdf-container" data-url="../assets/poster/neutrino-light-curve.pdf">
			<canvas class="pdf-canvas"></canvas>
			<div class="textLayer pdf-text"></div>
		</div>

	</main>
</body>
</html>